<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Constance - Suivi d'apprentissage minimaliste</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üî•</text></svg>">
    <style>
        /* ===== RESET & VARIABLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-main: #FAF9F7;
            --bg-white: #FFFFFF;
            --bg-light: #F5F4F2;
            --border: #E8E6E1;
            
            --text-primary: #2C3A47;
            --text-secondary: #6D7B8C;
            --text-tertiary: #A6B1C0;
            
            --blue: #4A6FA5;
            --blue-hover: #385D8A;
            --blue-light: #E8F4F8;
            --green: #2E8B57;
            --green-light: #E8F5E9;
            --red: #D9534F;
            --red-light: #FDE8E7;
            
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.04);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.12);
            
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            
            --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ===== ANIMATIONS ===== */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-4px); }
        }

        @keyframes checkmark {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes progressFill {
            from { width: 0%; }
            to { width: var(--progress-width, 0%); }
        }

        /* ===== BASE STYLES ===== */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', 'SF Pro Display', sans-serif;
            background: var(--bg-main);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 24px;
            animation: fadeIn 0.6s ease-out;
        }

        /* ===== HEADER ===== */
        .header {
            text-align: center;
            padding: 32px 0 24px;
            position: relative;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 20%;
            right: 20%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--blue), transparent);
            border-radius: 1px;
        }

        .app-title {
            font-size: 32px;
            font-weight: 800;
            letter-spacing: -0.5px;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--blue), #6A93C9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .app-tagline {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
            margin-top: 4px;
        }

        /* ===== STREAK BADGE ===== */
        .streak-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin: 28px 0;
            animation: slideIn 0.5s ease-out;
        }

        .streak-badge {
            background: linear-gradient(135deg, var(--blue), var(--blue-hover));
            color: white;
            padding: 14px 28px;
            border-radius: var(--radius-lg);
            font-size: 17px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .streak-badge::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { left: -100%; }
            20%, 100% { left: 100%; }
        }

        .streak-badge.updated {
            animation: pulse 0.6s ease, float 3s ease-in-out infinite 0.6s;
        }

        .fire-icon {
            animation: float 2s ease-in-out infinite;
        }

        /* ===== CONTEXT ===== */
        .context {
            text-align: center;
            margin: 32px 0;
            background: var(--bg-white);
            padding: 24px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border);
            animation: fadeIn 0.7s ease-out 0.2s both;
        }

        .domain {
            font-size: 22px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .objective {
            font-size: 15px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        /* ===== PROGRESS BAR ===== */
        .progress-container {
            margin: 32px 0;
            animation: fadeIn 0.7s ease-out 0.3s both;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .progress-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .progress-percent {
            font-size: 14px;
            font-weight: 700;
            color: var(--blue);
        }

        .progress-bar {
            height: 10px;
            background: var(--bg-light);
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--blue), #6A93C9);
            border-radius: 5px;
            width: 0%;
            transition: width 1s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
        }

        .progress-fill.animated {
            animation: progressFill 1s ease-out;
        }

        /* ===== DURATION BUTTONS ===== */
        .duration-section {
            margin: 40px 0;
            animation: fadeIn 0.7s ease-out 0.4s both;
        }

        .question {
            text-align: center;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 32px;
            color: var(--text-primary);
            position: relative;
            display: inline-block;
            left: 50%;
            transform: translateX(-50%);
            padding: 0 20px;
        }

        .question::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 20px;
            right: 20px;
            height: 3px;
            background: var(--blue);
            border-radius: 2px;
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .question:hover::after {
            transform: scaleX(1);
        }

        .duration-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-bottom: 32px;
        }

        .duration-btn {
            flex: 1;
            background: var(--bg-white);
            border: 2px solid var(--border);
            border-radius: var(--radius-md);
            padding: 28px 16px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: 800;
            color: var(--text-primary);
            position: relative;
            overflow: hidden;
            min-height: 120px;
            max-width: 140px;
            box-shadow: var(--shadow-sm);
        }

        .duration-btn:hover {
            transform: translateY(-4px);
            border-color: var(--blue);
            box-shadow: var(--shadow-md);
        }

        .duration-btn.active {
            background: linear-gradient(135deg, var(--blue), #6A93C9);
            border-color: var(--blue);
            color: white;
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .duration-btn span {
            font-size: 13px;
            font-weight: 600;
            margin-top: 8px;
            opacity: 0.8;
        }

        .duration-btn.active span {
            color: rgba(255,255,255,0.9);
        }

        .duration-btn .drag-hint {
            position: absolute;
            bottom: 8px;
            font-size: 11px;
            opacity: 0;
            transition: opacity 0.3s ease;
            color: var(--text-tertiary);
        }

        .duration-btn:hover .drag-hint {
            opacity: 0.6;
        }

        /* ===== VALIDATE BUTTON ===== */
        .validate-btn {
            width: 100%;
            padding: 20px;
            font-size: 17px;
            font-weight: 700;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition);
            margin: 32px 0;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }

        .validate-btn:disabled {
            background: var(--bg-light);
            color: var(--text-tertiary);
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        .validate-btn:enabled {
            background: linear-gradient(135deg, var(--blue), var(--blue-hover));
            color: white;
            box-shadow: var(--shadow-md);
        }

        .validate-btn:enabled:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .validate-btn:enabled:active {
            transform: translateY(-1px);
        }

        .validate-btn.validated {
            background: linear-gradient(135deg, var(--green), #3AA76D);
            cursor: default;
            animation: pulse 2s infinite;
        }

        /* ===== NAVIGATION ===== */
        .navigation {
            display: flex;
            justify-content: center;
            gap: 40px;
            padding: 32px 0 24px;
            border-top: 1px solid var(--border);
            margin-top: 32px;
            animation: fadeIn 0.7s ease-out 0.5s both;
        }

        .nav-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 15px;
            font-weight: 600;
            transition: var(--transition);
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-link:hover {
            color: var(--blue);
            background: var(--blue-light);
        }

        .nav-icon {
            font-size: 18px;
        }

        /* ===== SCREENS (Note, History, Settings) ===== */
        .screen {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }

        .screen.active {
            display: block;
        }

        /* ===== NOTE SCREEN ===== */
        .success-icon {
            font-size: 72px;
            color: var(--green);
            margin-bottom: 24px;
            animation: checkmark 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .success-title {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .success-subtitle {
            font-size: 17px;
            color: var(--text-secondary);
            margin-bottom: 48px;
            font-weight: 500;
        }

        .note-container {
            background: var(--bg-white);
            border: 2px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 32px;
            margin-bottom: 32px;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
        }

        .note-container:focus-within {
            border-color: var(--blue);
            box-shadow: 0 0 0 3px var(--blue-light);
        }

        .note-label {
            font-size: 17px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .note-textarea {
            width: 100%;
            min-height: 140px;
            padding: 16px;
            border: 2px solid var(--border);
            border-radius: var(--radius-md);
            font-family: inherit;
            font-size: 15px;
            line-height: 1.6;
            resize: vertical;
            transition: var(--transition);
            background: var(--bg-light);
        }

        .note-textarea:focus {
            outline: none;
            border-color: var(--blue);
            background: var(--bg-white);
            box-shadow: 0 0 0 3px var(--blue-light);
        }

        .char-count {
            text-align: right;
            font-size: 13px;
            color: var(--text-tertiary);
            margin-top: 12px;
        }

        .char-count.near-limit {
            color: var(--red);
            font-weight: 600;
        }

        .note-buttons {
            display: flex;
            gap: 16px;
        }

        .btn-skip, .btn-save {
            flex: 1;
            padding: 18px;
            border-radius: var(--radius-md);
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .btn-skip {
            background: transparent;
            border-color: var(--border);
            color: var(--text-secondary);
        }

        .btn-skip:hover {
            border-color: var(--text-secondary);
            background: var(--bg-light);
            transform: translateY(-2px);
        }

        .btn-save {
            background: linear-gradient(135deg, var(--green), #3AA76D);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .btn-save:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* ===== HISTORY SCREEN ===== */
        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            color: var(--blue);
            text-decoration: none;
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 32px;
            padding: 10px 16px;
            border-radius: var(--radius-sm);
            transition: var(--transition);
        }

        .back-button:hover {
            background: var(--blue-light);
            transform: translateX(-4px);
        }

        .calendar-header {
            font-size: 26px;
            font-weight: 800;
            margin-bottom: 36px;
            color: var(--text-primary);
            text-align: center;
        }

        .calendar {
            background: var(--bg-white);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 28px;
            margin-bottom: 32px;
            box-shadow: var(--shadow-sm);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 24px;
        }

        .calendar-day-header {
            text-align: center;
            font-size: 13px;
            font-weight: 700;
            color: var(--text-secondary);
            padding: 12px 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 15px;
            font-weight: 600;
            border-radius: var(--radius-sm);
            transition: var(--transition);
            position: relative;
            cursor: default;
        }

        .calendar-day.validated {
            background: linear-gradient(135deg, var(--blue), #6A93C9);
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .calendar-day.missed {
            background: var(--bg-light);
            color: var(--text-tertiary);
        }

        .calendar-day.today {
            background: linear-gradient(135deg, var(--green), #3AA76D);
            color: white;
            box-shadow: var(--shadow-md);
            animation: pulse 2s infinite;
        }

        .calendar-day:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--text-primary);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            margin-bottom: 8px;
            z-index: 1000;
            pointer-events: none;
        }

        .calendar-legend {
            display: flex;
            justify-content: center;
            gap: 32px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
        }

        .legend-dot.validated {
            background: linear-gradient(135deg, var(--blue), #6A93C9);
        }

        .legend-dot.missed {
            background: var(--bg-light);
            border: 2px solid var(--border);
        }

        .stats-container {
            display: grid;
            gap: 20px;
            margin-bottom: 32px;
        }

        .stats-card {
            background: var(--bg-white);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 28px;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
        }

        .stats-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }

        .stats-card h3 {
            font-size: 18px;
            font-weight: 800;
            margin-bottom: 16px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stats-content {
            padding-top: 16px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--bg-light);
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-label {
            font-size: 15px;
            color: var(--text-secondary);
        }

        .stat-number {
            font-size: 20px;
            font-weight: 800;
            color: var(--blue);
        }

        .notes-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .note-item {
            padding: 20px;
            background: var(--bg-light);
            border-radius: var(--radius-md);
            border-left: 4px solid var(--blue);
            transition: var(--transition);
        }

        .note-item:hover {
            transform: translateX(4px);
            background: var(--bg-white);
            box-shadow: var(--shadow-sm);
        }

        .note-date {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        .note-text {
            font-size: 15px;
            color: var(--text-primary);
            line-height: 1.6;
        }

        /* ===== SETTINGS SCREEN ===== */
        .setting-group {
            margin-bottom: 40px;
            animation: fadeIn 0.6s ease-out;
            animation-fill-mode: both;
        }

        .setting-group:nth-child(1) { animation-delay: 0.1s; }
        .setting-group:nth-child(2) { animation-delay: 0.2s; }
        .setting-group:nth-child(3) { animation-delay: 0.3s; }

        .setting-label {
            font-size: 17px;
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .setting-select {
            width: 100%;
            padding: 16px;
            font-size: 16px;
            border: 2px solid var(--border);
            border-radius: var(--radius-md);
            background: var(--bg-white);
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition);
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%234A6FA5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 16px center;
            background-size: 20px;
        }

        .setting-select:focus {
            outline: none;
            border-color: var(--blue);
            box-shadow: 0 0 0 3px var(--blue-light);
        }

        .duration-presets {
            display: flex;
            gap: 16px;
            margin-top: 20px;
        }

        .preset-btn {
            flex: 1;
            padding: 20px;
            background: var(--bg-white);
            border: 2px solid var(--border);
            border-radius: var(--radius-md);
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }

        .preset-btn:hover {
            border-color: var(--blue);
            transform: translateY(-2px);
        }

        .preset-hint {
            font-size: 13px;
            color: var(--text-tertiary);
            margin-top: 12px;
            text-align: center;
            font-style: italic;
        }

        .danger-zone {
            margin-top: 60px;
            padding-top: 32px;
            border-top: 2px solid var(--border);
            animation: fadeIn 0.6s ease-out 0.4s both;
        }

        .danger-zone .setting-label {
            color: var(--red);
        }

        .btn-reset {
            width: 100%;
            padding: 18px;
            background: transparent;
            border: 2px solid var(--red);
            border-radius: var(--radius-md);
            color: var(--red);
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-reset:hover {
            background: var(--red);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(217, 83, 79, 0.2);
        }

        .reset-warning {
            font-size: 13px;
            color: var(--text-tertiary);
            text-align: center;
            margin-top: 12px;
        }

        /* ===== MOBILE RESPONSIVE ===== */
        @media (max-width: 480px) {
            .container {
                padding: 20px 16px;
            }
            
            .duration-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .duration-btn {
                width: 100%;
                max-width: 200px;
            }
            
            .calendar-grid {
                gap: 6px;
            }
            
            .calendar-day {
                font-size: 13px;
            }
            
            .note-buttons {
                flex-direction: column;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .navigation {
                flex-direction: column;
                gap: 16px;
                align-items: center;
            }
            
            .nav-link {
                width: 100%;
                justify-content: center;
            }
        }

        /* ===== UTILITY CLASSES ===== */
        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        .fade-out {
            animation: fadeOut 0.3s ease-out forwards;
        }

        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(10px); }
        }

        .loading {
            opacity: 0.7;
            pointer-events: none;
            position: relative;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 24px;
            height: 24px;
            border: 3px solid var(--border);
            border-top-color: var(--blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Main Screen -->
    <div class="main-screen screen active" id="mainScreen">
        <div class="container">
            <div class="header">
                <h1 class="app-title">CONSTANCE</h1>
                <div class="app-tagline">La r√©gularit√©, pas la motivation</div>
            </div>

            <div class="streak-container">
                <div class="streak-badge" id="streakBadge">
                    <span class="fire-icon">üî•</span>
                    <span id="streakText">Jour 0</span>
                </div>
            </div>

            <div class="context">
                <div class="domain">
                    <span>üìö</span>
                    <span id="domainDisplay">Mon apprentissage</span>
                </div>
                <div class="objective">
                    <span>üéØ</span>
                    <span id="objectiveDisplay">Objectif : 20 min/jour</span>
                </div>
            </div>

            <div class="progress-container" id="progressContainer">
                <div class="progress-header">
                    <div class="progress-label">Progression aujourd'hui</div>
                    <div class="progress-percent" id="progressPercent">0%</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>

            <div class="duration-section">
                <div class="question">Dur√©e d'apprentissage ?</div>

                <div class="duration-buttons">
                    <button class="duration-btn" data-duration="20" id="btn20">
                        20
                        <span>minutes</span>
                        <div class="drag-hint">Glisser pour ajuster</div>
                    </button>
                    <button class="duration-btn" data-duration="40" id="btn40">
                        40
                        <span>minutes</span>
                        <div class="drag-hint">Glisser pour ajuster</div>
                    </button>
                    <button class="duration-btn" data-duration="60" id="btn60">
                        60
                        <span>minutes</span>
                        <div class="drag-hint">Glisser pour ajuster</div>
                    </button>
                </div>

                <button class="validate-btn" id="validateBtn" disabled>
                    Valider la session
                </button>
            </div>

            <div class="navigation">
                <a href="#" class="nav-link" id="linkHistory">
                    <span class="nav-icon">üìä</span>
                    Historique
                </a>
                <a href="#" class="nav-link" id="linkSettings">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    Param√®tres
                </a>
            </div>
        </div>
    </div>

    <!-- Note Screen -->
    <div class="screen" id="noteScreen">
        <div class="container">
            <div class="success-icon">‚úì</div>
            <h2 class="success-title">Session valid√©e !</h2>
            <p class="success-subtitle" id="sessionSummary">+20 min ¬∑ Jour 1</p>

            <div class="note-container">
                <div class="note-label">
                    <span>‚úçÔ∏è</span>
                    Aujourd'hui, j'ai appris ou compris...
                </div>
                <textarea 
                    class="note-textarea" 
                    id="noteTextarea" 
                    placeholder="Ex: J'ai compris les fonctions en JavaScript, ou j'ai pratiqu√© les commandes Git..."
                    maxlength="200"
                    rows="4"
                ></textarea>
                <div class="char-count" id="charCount">
                    <span>0</span>/200 caract√®res
                </div>
            </div>

            <div class="note-buttons">
                <button class="btn-skip" id="btnSkip">Passer</button>
                <button class="btn-save" id="btnSave">Enregistrer</button>
            </div>
        </div>
    </div>

    <!-- History Screen -->
    <div class="screen" id="historyScreen">
        <div class="container">
            <a href="#" class="back-button" id="backFromHistory">
                <span>‚Üê</span>
                Retour
            </a>

            <h2 class="calendar-header" id="currentMonth">F√©vrier 2026</h2>

            <div class="calendar">
                <div class="calendar-grid">
                    <div class="calendar-day-header">Lun</div>
                    <div class="calendar-day-header">Mar</div>
                    <div class="calendar-day-header">Mer</div>
                    <div class="calendar-day-header">Jeu</div>
                    <div class="calendar-day-header">Ven</div>
                    <div class="calendar-day-header">Sam</div>
                    <div class="calendar-day-header">Dim</div>
                    <div id="calendarDays"></div>
                </div>
                <div class="calendar-legend">
                    <div class="legend-item">
                        <div class="legend-dot validated"></div>
                        <span>Valid√©</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot missed"></div>
                        <span>Manqu√©</span>
                    </div>
                </div>
            </div>

            <div class="stats-container">
                <div class="stats-card">
                    <h3><span>üìà</span> Cette semaine</h3>
                    <div class="stats-content">
                        <div class="stat-item">
                            <span class="stat-label">Jours valid√©s</span>
                            <span class="stat-number" id="weekDays">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Minutes totales</span>
                            <span class="stat-number" id="weekMinutes">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Moyenne/jour</span>
                            <span class="stat-number" id="weekAverage">0</span>
                        </div>
                    </div>
                </div>

                <div class="stats-card">
                    <h3><span>üìÖ</span> Ce mois-ci</h3>
                    <div class="stats-content">
                        <div class="stat-item">
                            <span class="stat-label">Taux de r√©ussite</span>
                            <span class="stat-number" id="monthRate">0%</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Meilleur streak</span>
                            <span class="stat-number" id="bestStreak">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="stats-card">
                <h3><span>üìù</span> Derni√®res notes</h3>
                <div class="stats-content">
                    <div class="notes-list" id="notesList">
                        <p style="color: var(--text-secondary); font-size: 15px; text-align: center; padding: 32px;">
                            Aucune note pour le moment. Ajoutez des notes pour suivre vos apprentissages !
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Screen -->
    <div class="screen" id="settingsScreen">
        <div class="container">
            <a href="#" class="back-button" id="backFromSettings">
                <span>‚Üê</span>
                Retour
            </a>

            <div class="setting-group">
                <label class="setting-label">
                    <span>üéØ</span>
                    Domaine d'apprentissage
                </label>
                <select class="setting-select" id="domainSelect">
                    <option value="Mon apprentissage">Mon apprentissage</option>
                    <option value="Python">Python</option>
                    <option value="JavaScript">JavaScript</option>
                    <option value="Git & GitHub">Git & GitHub</option>
                    <option value="Math√©matiques">Math√©matiques</option>
                    <option value="Anglais">Anglais</option>
                    <option value="Design">Design</option>
                    <option value="Marketing">Marketing</option>
                    <option value="Autre">Autre</option>
                </select>
            </div>

            <div class="setting-group">
                <label class="setting-label">
                    <span>‚è±Ô∏è</span>
                    Objectif minimum quotidien
                </label>
                <select class="setting-select" id="objectiveSelect">
                    <option value="15">15 minutes</option>
                    <option value="20" selected>20 minutes</option>
                    <option value="30">30 minutes</option>
                    <option value="45">45 minutes</option>
                    <option value="60">60 minutes</option>
                    <option value="90">90 minutes</option>
                </select>
                <div class="preset-hint">Un objectif atteignable est plus durable</div>
            </div>

            <div class="setting-group">
                <label class="setting-label">
                    <span>‚ö°</span>
                    Dur√©es rapides
                </label>
                <div class="duration-presets">
                    <div class="preset-btn" id="preset1">20</div>
                    <div class="preset-btn" id="preset2">40</div>
                    <div class="preset-btn" id="preset3">60</div>
                </div>
                <div class="preset-hint">Cliquez pour modifier ces dur√©es</div>
            </div>

            <div class="danger-zone">
                <label class="setting-label">
                    <span>‚ö†Ô∏è</span>
                    Zone dangereuse
                </label>
                <button class="btn-reset" id="btnResetData">
                    <span>üóëÔ∏è</span>
                    R√©initialiser toutes les donn√©es
                </button>
                <div class="reset-warning">
                    Attention : cette action supprime d√©finitivement toutes vos donn√©es
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== CONFIGURATION =====
        const APP_NAME = 'Constance';
        const VERSION = '1.0.0';
        const MAX_NOTE_LENGTH = 200;

        // ===== DATA STRUCTURE =====
        const DEFAULT_DATA = {
            streak: 0,
            lastValidation: null,
            domain: 'Mon apprentissage',
            objective: 20,
            presets: [20, 40, 60],
            sessions: [],
            totalDays: 0,
            bestStreak: 0,
            totalMinutes: 0,
            createdAt: new Date().toISOString()
        };

        // ===== STATE =====
        let appData = null;
        let selectedDuration = null;
        let isDragging = false;
        let currentDragBtn = null;
        let dragStartX = 0;
        let originalDuration = 0;

        // ===== STORAGE =====
        function loadData() {
            try {
                const stored = localStorage.getItem(APP_NAME);
                if (stored) {
                    const data = JSON.parse(stored);
                    // Migration from old versions if needed
                    return { ...DEFAULT_DATA, ...data };
                }
            } catch (e) {
                console.warn('Error loading data:', e);
            }
            return { ...DEFAULT_DATA };
        }

        function saveData() {
            try {
                localStorage.setItem(APP_NAME, JSON.stringify(appData));
            } catch (e) {
                console.error('Error saving data:', e);
            }
        }

        function resetData() {
            if (confirm('√ätes-vous ABSOLUMENT s√ªr ? Toutes vos donn√©es seront perdues.')) {
                if (confirm('Derni√®re confirmation. Cette action est irr√©versible.')) {
                    localStorage.removeItem(APP_NAME);
                    appData = { ...DEFAULT_DATA };
                    saveData();
                    initApp();
                    showToast('Donn√©es r√©initialis√©es', 'success');
                }
            }
        }

        // ===== UTILITIES =====
        function getToday() {
            return new Date().toISOString().split('T')[0];
        }

        function formatDate(dateStr, withTime = false) {
            const date = new Date(dateStr);
            const options = { 
                day: 'numeric', 
                month: 'short',
                ...(withTime && { hour: '2-digit', minute: '2-digit' })
            };
            return date.toLocaleDateString('fr-FR', options);
        }

        function getWeekNumber(date) {
            const d = new Date(date);
            d.setHours(0, 0, 0, 0);
            d.setDate(d.getDate() + 4 - (d.getDay() || 7));
            const yearStart = new Date(d.getFullYear(), 0, 1);
            return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        }

        function animateElement(element, animation) {
            element.classList.add(animation);
            setTimeout(() => element.classList.remove(animation), 1000);
        }

        function showToast(message, type = 'info') {
            // Create toast element
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 24px;
                right: 24px;
                background: ${type === 'success' ? 'var(--green)' : 'var(--blue)'};
                color: white;
                padding: 12px 20px;
                border-radius: var(--radius-md);
                box-shadow: var(--shadow-lg);
                z-index: 10000;
                animation: slideIn 0.3s ease-out;
                font-weight: 600;
                display: flex;
                align-items: center;
                gap: 8px;
            `;
            toast.innerHTML = `${type === 'success' ? '‚úì' : '‚ÑπÔ∏è'} ${message}`;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'fadeOut 0.3s ease-out forwards';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // ===== STREAK MANAGEMENT =====
        function calculateStreak() {
            const today = getToday();
            const lastVal = appData.lastValidation;
            
            if (!lastVal) {
                appData.streak = 0;
                return;
            }
            
            const lastDate = new Date(lastVal);
            const todayDate = new Date(today);
            const diffTime = todayDate - lastDate;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 1) {
                // Consecutive day
                appData.streak += 1;
                if (appData.streak > appData.bestStreak) {
                    appData.bestStreak = appData.streak;
                }
            } else if (diffDays > 1) {
                // Streak broken
                appData.streak = 0;
            }
            // diffDays === 0: same day, keep streak
        }

        function hasSessionToday() {
            return appData.sessions.some(s => s.date === getToday());
        }

        function getTodaySession() {
            return appData.sessions.find(s => s.date === getToday());
        }

        // ===== PROGRESS BAR =====
        function updateProgress() {
            const objective = appData.objective;
            const progress = selectedDuration ? (selectedDuration / objective) * 100 : 0;
            
            const progressFill = document.getElementById('progressFill');
            const progressPercent = document.getElementById('progressPercent');
            
            progressFill.style.width = `${Math.min(progress, 100)}%`;
            progressPercent.textContent = `${Math.round(progress)}%`;
            
            // Animate on change
            if (progress > 0) {
                progressFill.classList.add('animated');
                setTimeout(() => progressFill.classList.remove('animated'), 1000);
            }
        }

        // ===== MAIN SCREEN RENDER =====
        function renderMainScreen() {
            // Update streak with animation
            const streakBadge = document.getElementById('streakBadge');
            const oldStreak = parseInt(streakBadge.textContent.match(/\d+/)?.[0] || 0);
            const newStreak = appData.streak;
            
            document.getElementById('streakText').textContent = `Jour ${newStreak}`;
            
            if (newStreak > oldStreak) {
                animateElement(streakBadge, 'updated');
                if (newStreak >= 3) {
                    showToast(`Super ! ${newStreak} jours d'affil√©e !`, 'success');
                }
            }
            
            // Update domain and objective
            document.getElementById('domainDisplay').textContent = appData.domain;
            document.getElementById('objectiveDisplay').textContent = `Objectif : ${appData.objective} min/jour`;
            
            // Update duration buttons
            const btnIds = ['btn20', 'btn40', 'btn60'];
            appData.presets.forEach((duration, index) => {
                const btn = document.getElementById(btnIds[index]);
                btn.innerHTML = `${duration}<span>minutes</span><div class="drag-hint">Glisser pour ajuster</div>`;
                btn.dataset.duration = duration;
            });
            
            // Check if already validated today
            const validateBtn = document.getElementById('validateBtn');
            const durationBtns = document.querySelectorAll('.duration-btn');
            
            if (hasSessionToday()) {
                const session = getTodaySession();
                validateBtn.innerHTML = `‚úì ${session.duration} min valid√©s`;
                validateBtn.classList.add('validated');
                validateBtn.disabled = true;
                
                durationBtns.forEach(btn => {
                    btn.disabled = true;
                    btn.style.opacity = '0.5';
                    btn.style.cursor = 'not-allowed';
                    btn.classList.remove('active');
                });
                
                // Update progress bar with actual session
                selectedDuration = session.duration;
                updateProgress();
            } else {
                validateBtn.textContent = 'Valider la session';
                validateBtn.classList.remove('validated');
                validateBtn.disabled = !selectedDuration;
                
                durationBtns.forEach(btn => {
                    btn.disabled = false;
                    btn.style.opacity = '1';
                    btn.style.cursor = 'pointer';
                });
                
                // Reset progress if no selection
                if (!selectedDuration) {
                    updateProgress();
                }
            }
            
            // Show/hide progress container
            document.getElementById('progressContainer').style.display = 
                selectedDuration || hasSessionToday() ? 'block' : 'none';
        }

        // ===== DURATION SELECTION =====
        function setupDurationButtons() {
            document.querySelectorAll('.duration-btn').forEach(btn => {
                // Click selection
                btn.addEventListener('click', handleDurationClick);
                
                // Drag to adjust
                btn.addEventListener('mousedown', startDrag);
                btn.addEventListener('touchstart', startDrag);
            });
        }

        function handleDurationClick(e) {
            if (hasSessionToday()) return;
            
            // Remove active from all
            document.querySelectorAll('.duration-btn').forEach(b => b.classList.remove('active'));
            
            // Add active to clicked
            const btn = e.currentTarget;
            btn.classList.add('active');
            selectedDuration = parseInt(btn.dataset.duration);
            
            // Update progress and enable validate button
            updateProgress();
            document.getElementById('validateBtn').disabled = false;
            
            // Animation feedback
            animateElement(btn, 'pulse');
        }

        // ===== DRAG TO ADJUST =====
        function startDrag(e) {
            if (hasSessionToday()) return;
            
            e.preventDefault();
            isDragging = true;
            currentDragBtn = e.currentTarget;
            originalDuration = parseInt(currentDragBtn.dataset.duration);
            dragStartX = e.clientX || e.touches[0].clientX;
            
            // Visual feedback
            currentDragBtn.style.cursor = 'grabbing';
            
            document.addEventListener('mousemove', handleDrag);
            document.addEventListener('touchmove', handleDrag);
            document.addEventListener('mouseup', stopDrag);
            document.addEventListener('touchend', stopDrag);
            
            // Prevent text selection during drag
            document.body.style.userSelect = 'none';
        }

        function handleDrag(e) {
            if (!isDragging) return;
            
            const clientX = e.clientX || e.touches[0].clientX;
            const deltaX = clientX - dragStartX;
            const sensitivity = 0.5; // Pixels per minute
            
            // Calculate new duration (5-120 minutes, steps of 5)
            let newDuration = originalDuration + Math.round(deltaX * sensitivity / 5) * 5;
            newDuration = Math.max(5, Math.min(120, newDuration));
            
            // Update button
            currentDragBtn.dataset.duration = newDuration;
            currentDragBtn.innerHTML = `${newDuration}<span>minutes</span><div class="drag-hint">Glisser pour ajuster</div>`;
            
            // If this button was active, update selection
            if (currentDragBtn.classList.contains('active')) {
                selectedDuration = newDuration;
                updateProgress();
                document.getElementById('validateBtn').disabled = false;
            }
        }

        function stopDrag() {
            if (!isDragging) return;
            
            isDragging = false;
            if (currentDragBtn) {
                currentDragBtn.style.cursor = 'pointer';
                
                // Save the new preset if needed
                const btnIndex = ['btn20', 'btn40', 'btn60'].indexOf(currentDragBtn.id);
                if (btnIndex !== -1) {
                    appData.presets[btnIndex] = parseInt(currentDragBtn.dataset.duration);
                    saveData();
                }
            }
            
            document.removeEventListener('mousemove', handleDrag);
            document.removeEventListener('touchmove', handleDrag);
            document.removeEventListener('mouseup', stopDrag);
            document.removeEventListener('touchend', stopDrag);
            
            document.body.style.userSelect = '';
        }

        // ===== SESSION VALIDATION =====
        function setupValidation() {
            document.getElementById('validateBtn').addEventListener('click', validateSession);
        }

        function validateSession() {
            if (!selectedDuration || hasSessionToday()) return;
            
            // Calculate streak first
            calculateStreak();
            
            // Create session
            const session = {
                date: getToday(),
                duration: selectedDuration,
                note: '',
                timestamp: new Date().toISOString()
            };
            
            appData.sessions.push(session);
            appData.lastValidation = getToday();
            appData.totalMinutes += selectedDuration;
            
            // Update best streak if needed
            if (appData.streak > appData.bestStreak) {
                appData.bestStreak = appData.streak;
            }
            
            saveData();
            
            // Show note screen with animation
            showNoteScreen();
        }

        // ===== NOTE SCREEN =====
        function showNoteScreen() {
            const session = getTodaySession();
            document.getElementById('sessionSummary').textContent = 
                `+${session.duration} min ¬∑ Jour ${appData.streak}`;
            
            // Reset textarea
            const textarea = document.getElementById('noteTextarea');
            textarea.value = '';
            updateCharCount();
            
            // Switch screens with animation
            document.getElementById('mainScreen').classList.remove('active');
            document.getElementById('noteScreen').classList.add('active');
            
            // Focus textarea after animation
            setTimeout(() => textarea.focus(), 300);
        }

        function setupNoteScreen() {
            const textarea = document.getElementById('noteTextarea');
            const charCount = document.getElementById('charCount');
            
            textarea.addEventListener('input', updateCharCount);
            document.getElementById('btnSkip').addEventListener('click', skipNote);
            document.getElementById('btnSave').addEventListener('click', saveNote);
            
            function updateCharCount() {
                const length = textarea.value.length;
                charCount.textContent = `${length}/${MAX_NOTE_LENGTH}`;
                charCount.classList.toggle('near-limit', length > MAX_NOTE_LENGTH * 0.9);
            }
            
            function skipNote() {
                returnToMain();
            }
            
            function saveNote() {
                const note = textarea.value.trim();
                const session = getTodaySession();
                
                if (session && note) {
                    session.note = note;
                    saveData();
                    showToast('Note enregistr√©e', 'success');
                }
                
                returnToMain();
            }
        }

        function returnToMain() {
            document.getElementById('noteScreen').classList.remove('active');
            document.getElementById('mainScreen').classList.add('active');
            
            // Reset selection
            selectedDuration = null;
            document.querySelectorAll('.duration-btn').forEach(btn => btn.classList.remove('active'));
            
            // Re-render
            renderMainScreen();
        }

        // ===== HISTORY SCREEN =====
        function setupHistoryScreen() {
            document.getElementById('linkHistory').addEventListener('click', showHistoryScreen);
            document.getElementById('backFromHistory').addEventListener('click', hideHistoryScreen);
        }

        function showHistoryScreen(e) {
            e?.preventDefault();
            document.getElementById('mainScreen').classList.remove('active');
            document.getElementById('historyScreen').classList.add('active');
            renderHistoryScreen();
        }

        function hideHistoryScreen(e) {
            e?.preventDefault();
            document.getElementById('historyScreen').classList.remove('active');
            document.getElementById('mainScreen').classList.add('active');
        }

        function renderHistoryScreen() {
            renderCalendar();
            renderStats();
            renderRecentNotes();
        }

        function renderCalendar() {
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth();
            
            // Update month header
            const monthNames = [
                'Janvier', 'F√©vrier', 'Mars', 'Avril', 'Mai', 'Juin', 
                'Juillet', 'Ao√ªt', 'Septembre', 'Octobre', 'Novembre', 'D√©cembre'
            ];
            document.getElementById('currentMonth').textContent = `${monthNames[month]} ${year}`;
            
            // Get calendar data
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const firstDayOfWeek = (firstDay.getDay() + 6) % 7; // Monday = 0
            
            const calendarDays = document.getElementById('calendarDays');
            calendarDays.innerHTML = '';
            
            // Empty cells before first day
            for (let i = 0; i < firstDayOfWeek; i++) {
                calendarDays.innerHTML += '<div class="calendar-day"></div>';
            }
            
            // Days of month
            const today = getToday();
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const session = appData.sessions.find(s => s.date === dateStr);
                
                let className = 'calendar-day';
                let tooltip = formatDate(dateStr);
                
                if (dateStr === today) {
                    className += ' today';
                    tooltip += ' (Aujourd\'hui)';
                } else if (session) {
                    className += ' validated';
                    tooltip += ` ¬∑ ${session.duration} min`;
                    if (session.note) {
                        tooltip += `\n"${session.note.substring(0, 50)}${session.note.length > 50 ? '...' : ''}"`;
                    }
                } else if (new Date(dateStr) < new Date(today)) {
                    className += ' missed';
                }
                
                calendarDays.innerHTML += 
                    `<div class="${className}" data-tooltip="${tooltip}">${day}</div>`;
            }
        }

        function renderStats() {
            const now = new Date();
            const today = getToday();
            const oneWeekAgo = new Date(now);
            oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
            
            const oneMonthAgo = new Date(now);
            oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
            
            // Week stats
            const weekSessions = appData.sessions.filter(s => {
                const sessionDate = new Date(s.date);
                return sessionDate >= oneWeekAgo && sessionDate <= now;
            });
            
            const weekDays = weekSessions.length;
            const weekMinutes = weekSessions.reduce((sum, s) => sum + s.duration, 0);
            const weekAverage = weekDays > 0 ? Math.round(weekMinutes / weekDays) : 0;
            
            document.getElementById('weekDays').textContent = weekDays;
            document.getElementById('weekMinutes').textContent = weekMinutes;
            document.getElementById('weekAverage').textContent = weekAverage;
            
            // Month stats
            const monthSessions = appData.sessions.filter(s => {
                const sessionDate = new Date(s.date);
                return sessionDate >= oneMonthAgo && sessionDate <= now;
            });
            
            const monthDays = Math.floor((now - oneMonthAgo) / (1000 * 60 * 60 * 24));
            const monthRate = monthDays > 0 ? Math.round((monthSessions.length / monthDays) * 100) : 0;
            
            document.getElementById('monthRate').textContent = `${monthRate}%`;
            document.getElementById('bestStreak').textContent = appData.bestStreak;
        }

        function renderRecentNotes() {
            const notesList = document.getElementById('notesList');
            const recentNotes = appData.sessions
                .filter(s => s.note && s.note.trim())
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);
            
            if (recentNotes.length === 0) {
                notesList.innerHTML = `
                    <p style="color: var(--text-secondary); font-size: 15px; text-align: center; padding: 32px;">
                        Aucune note pour le moment. Ajoutez des notes pour suivre vos apprentissages !
                    </p>`;
            } else {
                notesList.innerHTML = recentNotes.map(session => `
                    <div class="note-item">
                        <div class="note-date">
                            <span>${formatDate(session.date)}</span>
                            <span>¬∑</span>
                            <span>${session.duration} min</span>
                        </div>
                        <div class="note-text">"${session.note}"</div>
                    </div>
                `).join('');
            }
        }

        // ===== SETTINGS SCREEN =====
        function setupSettingsScreen() {
            document.getElementById('linkSettings').addEventListener('click', showSettingsScreen);
            document.getElementById('backFromSettings').addEventListener('click', hideSettingsScreen);
            
            // Domain change
            document.getElementById('domainSelect').addEventListener('change', function() {
                appData.domain = this.value;
                saveData();
                showToast('Domaine mis √† jour', 'success');
            });
            
            // Objective change
            document.getElementById('objectiveSelect').addEventListener('change', function() {
                appData.objective = parseInt(this.value);
                saveData();
                showToast(`Objectif : ${appData.objective} min/jour`, 'success');
                if (selectedDuration) updateProgress();
            });
            
            // Preset editing
            ['preset1', 'preset2', 'preset3'].forEach((id, index) => {
                document.getElementById(id).addEventListener('click', () => {
                    const newValue = prompt(
                        `Nouvelle dur√©e pour le bouton ${index + 1} (5-120 minutes) :`,
                        appData.presets[index]
                    );
                    
                    if (newValue && !isNaN(newValue)) {
                        const duration = parseInt(newValue);
                        if (duration >= 5 && duration <= 120) {
                            appData.presets[index] = duration;
                            saveData();
                            document.getElementById(id).textContent = duration;
                            showToast(`Dur√©e ${index + 1} : ${duration} min`, 'success');
                            renderMainScreen();
                        } else {
                            alert('Veuillez entrer un nombre entre 5 et 120 minutes.');
                        }
                    }
                });
            });
            
            // Reset data
            document.getElementById('btnResetData').addEventListener('click', resetData);
        }

        function showSettingsScreen(e) {
            e?.preventDefault();
            
            // Populate current settings
            document.getElementById('domainSelect').value = appData.domain;
            document.getElementById('objectiveSelect').value = appData.objective.toString();
            
            const presetIds = ['preset1', 'preset2', 'preset3'];
            appData.presets.forEach((duration, index) => {
                document.getElementById(presetIds[index]).textContent = duration;
            });
            
            document.getElementById('mainScreen').classList.remove('active');
            document.getElementById('settingsScreen').classList.add('active');
        }

        function hideSettingsScreen(e) {
            e?.preventDefault();
            document.getElementById('settingsScreen').classList.remove('active');
            document.getElementById('mainScreen').classList.add('active');
            renderMainScreen();
        }

        // ===== APP INITIALIZATION =====
        function initApp() {
            // Load data
            appData = loadData();
            
            // Calculate streak on app start
            calculateStreak();
            saveData();
            
            // Setup all event listeners
            setupDurationButtons();
            setupValidation();
            setupNoteScreen();
            setupHistoryScreen();
            setupSettingsScreen();
            
            // Initial render
            renderMainScreen();
            
            // Show welcome message on first visit
            if (!appData.lastValidation) {
                setTimeout(() => {
                    showToast('Bienvenue sur Constance ! Commencez par choisir une dur√©e.', 'info');
                }, 1000);
            }
            
            // Log app info
            console.log(`${APP_NAME} v${VERSION} - ${appData.sessions.length} sessions`);
        }

        // ===== START THE APP =====
        document.addEventListener('DOMContentLoaded', initApp);

        // ===== SERVICE WORKER FOR PWA (optional) =====
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').catch(err => {
                    console.log('ServiceWorker registration failed:', err);
                });
            });
        }
    </script>
</body>
</html>
